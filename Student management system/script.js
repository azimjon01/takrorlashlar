// Ma'lumotlar!
// let data = [
//     {
//       "id": 1,
//       "ism": "Ali",
//       "familiya": "Karimov",
//       "yosh": 25,
//       "jins": "Erkak",
//       "email": "ali.karimov@example.com",
//       "telefon": "+998901234567",
//       "manzil": "Toshkent, Chilonzor tumani"
//     },
//     {
//       "id": 2,
//       "ism": "Laylo",
//       "familiya": "Abdullayeva",
//       "yosh": 22,
//       "jins": "Ayol",
//       "email": "laylo.abdullayeva@example.com",
//       "telefon": "+998911234567",
//       "manzil": "Farg'ona, Marg'ilon shahri"
//     },
//     {
//       "id": 3,
//       "ism": "Rustam",
//       "familiya": "Ismatov",
//       "yosh": 30,
//       "jins": "Erkak",
//       "email": "rustam.ismatov@example.com",
//       "telefon": "+998931234567",
//       "manzil": "Samarqand, Registon mahallasi"
//     },
//     {
//       "id": 4,
//       "ism": "Dilnoza",
//       "familiya": "Sadullayeva",
//       "yosh": 27,
//       "jins": "Ayol",
//       "email": "dilnoza.sadullayeva@example.com",
//       "telefon": "+998941234567",
//       "manzil": "Buxoro, G'ijduvon tumani"
//     },
//     {
//       "id": 5,
//       "ism": "Aziz",
//       "familiya": "Shokirov",
//       "yosh": 35,
//       "jins": "Erkak",
//       "email": "aziz.shokirov@example.com",
//       "telefon": "+998951234567",
//       "manzil": "Andijon, Shahrixon tumani"
//     },
//     {
//       "id": 6,
//       "ism": "Shahzoda",
//       "familiya": "Tursunova",
//       "yosh": 20,
//       "jins": "Ayol",
//       "email": "shahzoda.tursunova@example.com",
//       "telefon": "+998961234567",
//       "manzil": "Namangan, Pop tumani"
//     },
//     {
//       "id": 7,
//       "ism": "Murod",
//       "familiya": "Yoqubov",
//       "yosh": 28,
//       "jins": "Erkak",
//       "email": "murod.yoqubov@example.com",
//       "telefon": "+998971234567",
//       "manzil": "Qashqadaryo, Qarshi shahri"
//     },
//     {
//       "id": 8,
//       "ism": "Zarina",
//       "familiya": "Yo'ldosheva",
//       "yosh": 24,
//       "jins": "Ayol",
//       "email": "zarina.yoldosheva@example.com",
//       "telefon": "+998981234567",
//       "manzil": "Xorazm, Urganch shahri"
//     },
//     {
//       "id": 9,
//       "ism": "Farrux",
//       "familiya": "Tojiyev",
//       "yosh": 29,
//       "jins": "Erkak",
//       "email": "farrux.tojiyev@example.com",
//       "telefon": "+998991234567",
//       "manzil": "Jizzax, Zomin tumani"
//     },
//     {
//       "id": 10,
//       "ism": "Malika",
//       "familiya": "Olimova",
//       "yosh": 26,
//       "jins": "Ayol",
//       "email": "malika.olimova@example.com",
//       "telefon": "+998901234568",
//       "manzil": "Surxondaryo, Termiz shahri"
//     },
//     {
//       "id": 11,
//       "ism": "Odil",
//       "familiya": "Sobirov",
//       "yosh": 33,
//       "jins": "Erkak",
//       "email": "odil.sobirov@example.com",
//       "telefon": "+998911234568",
//       "manzil": "Navoiy, Zarafshon shahri"
//     },
//     {
//       "id": 12,
//       "ism": "Saida",
//       "familiya": "Norboeva",
//       "yosh": 21,
//       "jins": "Ayol",
//       "email": "saida.norboeva@example.com",
//       "telefon": "+998931234568",
//       "manzil": "Toshkent, Mirzo Ulug'bek tumani"
//     },
//     {
//       "id": 13,
//       "ism": "Bekzod",
//       "familiya": "Eshmatov",
//       "yosh": 34,
//       "jins": "Erkak",
//       "email": "bekzod.eshmatov@example.com",
//       "telefon": "+998941234568",
//       "manzil": "Sirdaryo, Guliston shahri"
//     },
//     {
//       "id": 14,
//       "ism": "Nilufar",
//       "familiya": "Toshpulatova",
//       "yosh": 23,
//       "jins": "Ayol",
//       "email": "nilufar.toshpulatova@example.com",
//       "telefon": "+998951234568",
//       "manzil": "Qoraqalpog'iston, Nukus shahri"
//     },
//     {
//       "id": 15,
//       "ism": "Sherzod",
//       "familiya": "Murodov",
//       "yosh": 32,
//       "jins": "Erkak",
//       "email": "sherzod.murodov@example.com",
//       "telefon": "+998961234568",
//       "manzil": "Farg'ona, Qo'qon shahri"
//     },
//     {
//       "id": 16,
//       "ism": "Ali",
//       "familiya": "Karimov",
//       "yosh": 25,
//       "jins": "Erkak",
//       "email": "ali.karimov@example.com",
//       "telefon": "+998901234567",
//       "manzil": "Toshkent, Chilonzor tumani"
//     },
//     {
//       "id": 17,
//       "ism": "Laylo",
//       "familiya": "Abdullayeva",
//       "yosh": 22,
//       "jins": "Ayol",
//       "email": "laylo.abdullayeva@example.com",
//       "telefon": "+998911234567",
//       "manzil": "Farg'ona, Marg'ilon shahri"
//     },
//     {
//       "id": 18,
//       "ism": "Rustam",
//       "familiya": "Ismatov",
//       "yosh": 30,
//       "jins": "Erkak",
//       "email": "rustam.ismatov@example.com",
//       "telefon": "+998931234567",
//       "manzil": "Samarqand, Registon mahallasi"
//     },
//     {
//       "id": 19,
//       "ism": "Dilnoza",
//       "familiya": "Sadullayeva",
//       "yosh": 27,
//       "jins": "Ayol",
//       "email": "dilnoza.sadullayeva@example.com",
//       "telefon": "+998941234567",
//       "manzil": "Buxoro, G'ijduvon tumani"
//     },
//     {
//       "id": 20,
//       "ism": "Aziz",
//       "familiya": "Shokirov",
//       "yosh": 35,
//       "jins": "Erkak",
//       "email": "aziz.shokirov@example.com",
//       "telefon": "+998951234567",
//       "manzil": "Andijon, Shahrixon tumani"
//     },
//     {
//       "id": 21,
//       "ism": "Shahzoda",
//       "familiya": "Tursunova",
//       "yosh": 20,
//       "jins": "Ayol",
//       "email": "shahzoda.tursunova@example.com",
//       "telefon": "+998961234567",
//       "manzil": "Namangan, Pop tumani"
//     },
//     {
//       "id": 22,
//       "ism": "Murod",
//       "familiya": "Yoqubov",
//       "yosh": 28,
//       "jins": "Erkak",
//       "email": "murod.yoqubov@example.com",
//       "telefon": "+998971234567",
//       "manzil": "Qashqadaryo, Qarshi shahri"
//     },
//     {
//       "id": 23,
//       "ism": "Zarina",
//       "familiya": "Yo'ldosheva",
//       "yosh": 24,
//       "jins": "Ayol",
//       "email": "zarina.yoldosheva@example.com",
//       "telefon": "+998981234567",
//       "manzil": "Xorazm, Urganch shahri"
//     },
//     {
//       "id": 24,
//       "ism": "Farrux",
//       "familiya": "Tojiyev",
//       "yosh": 29,
//       "jins": "Erkak",
//       "email": "farrux.tojiyev@example.com",
//       "telefon": "+998991234567",
//       "manzil": "Jizzax, Zomin tumani"
//     },
//     {
//       "id": 25,
//       "ism": "Malika",
//       "familiya": "Olimova",
//       "yosh": 26,
//       "jins": "Ayol",
//       "email": "malika.olimova@example.com",
//       "telefon": "+998901234568",
//       "manzil": "Surxondaryo, Termiz shahri"
//     },
//     {
//       "id": 27,
//       "ism": "Odil",
//       "familiya": "Sobirov",
//       "yosh": 33,
//       "jins": "Erkak",
//       "email": "odil.sobirov@example.com",
//       "telefon": "+998911234568",
//       "manzil": "Navoiy, Zarafshon shahri"
//     },
//     {
//       "id": 28,
//       "ism": "Saida",
//       "familiya": "Norboeva",
//       "yosh": 21,
//       "jins": "Ayol",
//       "email": "saida.norboeva@example.com",
//       "telefon": "+998931234568",
//       "manzil": "Toshkent, Mirzo Ulug'bek tumani"
//     },
//     {
//       "id": 29,
//       "ism": "Bekzod",
//       "familiya": "Eshmatov",
//       "yosh": 34,
//       "jins": "Erkak",
//       "email": "bekzod.eshmatov@example.com",
//       "telefon": "+998941234568",
//       "manzil": "Sirdaryo, Guliston shahri"
//     },
//     {
//       "id": 30,
//       "ism": "Nilufar",
//       "familiya": "Toshpulatova",
//       "yosh": 23,
//       "jins": "Ayol",
//       "email": "nilufar.toshpulatova@example.com",
//       "telefon": "+998951234568",
//       "manzil": "Qoraqalpog'iston, Nukus shahri"
//     },
//     {
//       "id": 31,
//       "ism": "Sherzod",
//       "familiya": "Murodov",
//       "yosh": 32,
//       "jins": "Erkak",
//       "email": "sherzod.murodov@example.com",
//       "telefon": "+998961234568",
//       "manzil": "Farg'ona, Qo'qon shahri"
//     }
//   ]



// Js code  ---------------------------------------------------------------------------------

// Bazani yangilash


// inputs

const id = document.getElementById("id");
const ism = document.getElementById('ism');
const familiya = document.getElementById('familiya');
const yosh = document.getElementById('yosh');
const jins = document.getElementById('jins');
const email = document.getElementById('email');
const telefon = document.getElementById("telefon");
const manzil = document.getElementById('manzil');

// control buttons

const addBtn = document.getElementById("addBtn");
const updateBtn = document.getElementById("updateBtn");
const deleteBtn = document.getElementById("deleteBtn");
const clearBtn = document.getElementById("clearBtn");

// select input

const tanlash = document.getElementById("tanlash");

// Search

const search = document.getElementById("search");
const searchBtn = document.getElementById("searchBtn");
const allBtn = document.getElementById("allBtn");


let listContainer = document.getElementById("list__container");
// date
// const date = [];
// let num = 1;
// JS CODE

refreshData();

// save data in local Storage

function refreshData(){
  let storedData = JSON.parse(localStorage.getItem("dataSet")) || [];

  if(storedData.length === 0){
    saveData();
  }
}

// ids



// save data function

function saveData(){
  localStorage.setItem("dataSet",JSON.stringify(data));
}

// add information

addBtn.addEventListener("click",()=>{
  let inputs = [id, ism, familiya, yosh, jins, email, telefon, manzil];
  let emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  let phoneRegex = /^\+?[0-9]+$/;
if (inputs.some(input => input.value.trim() === "")) {
    alert("Barcha maydonlarni to'ldiring!");
    return;
}else if (!emailRegex.test(email.value)) {
  alert("Yaroqli email kiriting!");
  return;
}else if (!phoneRegex.test(telefon.value)) {
  alert("Yaroqli telefon raqami kiriting!");
  return;
}else{
    let obj={
      id: id.value,
      ism: ism.value,
      familiya: familiya.value,
      yosh: yosh.value,
      jins: jins.value,
      email: email.value,
      telefon: telefon.value,
      manzil: manzil.value,
    }
      id.value = "";
      ism.value = "";
      familiya.value = "";
      yosh.value = "";
      jins.value = "";
      email.value = "";
      telefon.value = "";
      manzil.value = "";
      addData(obj);
   }
})

// update information

updateBtn.addEventListener('click',()=>{
    let obj={
        id: id.value,
        ism: ism.value,
        familiya: familiya.value,
        yosh: yosh.value,
        jins: jins.value,
        email: email.value,
        telefon: telefon.value,
        manzil: manzil.value,
      }
    updateData(obj);

})

// delete information

deleteBtn.addEventListener("click",()=>{
    let idValue = id.value;
    if (idValue) {
        deleteData(idValue);
    } else {
        alert("Iltimos, o'chirish uchun ID ni tanlang.");
    }
})

// clear inputs function

clearBtn.addEventListener('click',()=>{
    clearInputs();
})

// add data function

// function addData(obj){
//     let addStoredData = JSON.parse(localStorage.getItem("dataSet")) || [];
//     let isDuplicate = addStoredData.some(item => item.id === obj.id);
//     if (isDuplicate) {
//       alert("Bu ID bilan ma'lumot allaqachon mavjud.");
//     } else {
//       addStoredData.push(obj);
//       localStorage.setItem("dataSet", JSON.stringify(addStoredData));
//       viewData();
//       alert("Muvaffaqiyatli qo'shildi");
//     }
// }

function addData(obj) {
  let storedData = JSON.parse(localStorage.getItem("dataSet")) || [];

  // ID mavjudligini tekshirish
  if (storedData.some(item => item.id === obj.id)) {
    alert(`ID ${obj.id} allaqachon mavjud! Yangi ID tanlang.`);
    return; // Funksiyani to'xtatish
  }

  // Yangi elementni qo'shish
  storedData.push(obj);
  localStorage.setItem("dataSet", JSON.stringify(storedData)); // Lokal storageni yangilash
  viewData(); // Jadvalni yangilash
  alert("Muvaffaqiyatli qo'shildi!");
}

// view data function

function viewData(){
  let dataSet = JSON.parse(localStorage.getItem('dataSet') || []);
  listContainer.innerHTML="";
  dataSet.forEach(element => {
  listContainer.innerHTML+=`<tr>
                                  <td>${element.id}</td>
                                  <td>${element.ism}</td>
                                  <td>${element.familiya}</td>
                                  <td>${element.yosh}</td>
                                  <td>${element.jins}</td>
                                  <td>${element.email}</td>
                                  <td>${element.telefon}</td>
                                  <td>${element.manzil}</td>
                              </tr>`;
  });
}

// selection display data function

listContainer.addEventListener("click",function(event){
    let clickedRow = event.target.closest("tr");
    if(clickedRow){
        let columns = clickedRow.children;
        if(columns.length>0){
            id.value = columns[0].textContent.trim();
            ism.value = columns[1].textContent.trim();
            familiya.value = columns[2].textContent.trim();
            yosh.value = columns[3].textContent.trim();
            jins.value = columns[4].textContent.trim();
            email.value = columns[5].textContent.trim();
            telefon.value = columns[6].textContent.trim();
            manzil.value = columns[7].textContent.trim();
        }
    }
});

// delete data function

function deleteData(id){
  let dataSet = JSON.parse(localStorage.getItem("dataSet")) || [];
  let updatedData = dataSet.filter(item=>item.id !== id);
  localStorage.setItem("dataSet",JSON.stringify(updatedData));
  viewData();
  alert("Ma'lumot o'chirildi!");
}

// update data function

function updateData(obj) {
    let dataSet = JSON.parse(localStorage.getItem("dataSet")) || [];
    let index = dataSet.findIndex(item => item.id === obj.id);
    if (index !== -1) {
        dataSet[index] = obj;
        localStorage.setItem("dataSet", JSON.stringify(dataSet));
        viewData();
    } else {
        alert("Element topilmadi.");
    }
}

// clear inputs function

function clearInputs(){
    id.value = "";
    ism.value = "";
    familiya.value = "";
    yosh.value = "";
    jins.value = "";
    email.value = "";
    telefon.value = "";
    manzil.value = "";
}

// search data

searchBtn.addEventListener("click", () => {
  let query = search.value.toLowerCase();
  let dataSet = JSON.parse(localStorage.getItem("dataSet")) || [];
  let filteredData = dataSet.filter(item =>
      item.ism.toLowerCase().includes(query) ||
      item.familiya.toLowerCase().includes(query)
  );
  listContainer.innerHTML = "";
  filteredData.forEach(element => {
      listContainer.innerHTML += `<tr>
          <td>${element.id}</td>
          <td>${element.ism}</td>
          <td>${element.familiya}</td>
          <td>${element.yosh}</td>
          <td>${element.jins}</td>
          <td>${element.email}</td>
          <td>${element.telefon}</td>
          <td>${element.manzil}</td>
      </tr>`;
  });
});

// All data

allBtn.addEventListener("click", () => {
  search.value = "";
  viewData();
});

// Select data

tanlash.addEventListener("change", () => {
  let selectedValue = tanlash.value;
  let dataSet = JSON.parse(localStorage.getItem("dataSet")) || [];

  let filteredData;
  if (selectedValue === "all") {
    filteredData = dataSet;
  } else {
    filteredData = dataSet.filter(item => item.jins.toLowerCase() === selectedValue);
  }

  // Jadvalni yangilash
  listContainer.innerHTML = "";
  filteredData.forEach(element => {
    listContainer.innerHTML += `<tr>
                                  <td>${element.id}</td>
                                  <td>${element.ism}</td>
                                  <td>${element.familiya}</td>
                                  <td>${element.yosh}</td>
                                  <td>${element.jins}</td>
                                  <td>${element.email}</td>
                                  <td>${element.telefon}</td>
                                  <td>${element.manzil}</td>
                              </tr>`;
  });
});




viewData()
